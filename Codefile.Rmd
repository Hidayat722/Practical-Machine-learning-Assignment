library(Hmisc)
library(caret)
library(randomForest)
library(foreach)
library(doParallel)
set.seed(1354785)

train_samples <- read.csv("pml-training.csv", na.strings=c("#DIV/0!") )
test_samples <- read.csv("pml-testing.csv", na.strings=c("#DIV/0!") )
for(i in c(8:ncol(train_samples)-1)) {train_samples[,i] = as.numeric(as.character(train_samples[,i]))}

for(i in c(8:ncol(test_samples)-1)) {test_samples[,i] = as.numeric(as.character(test_samples[,i]))}
selected_feats <- colnames(train_samples[colSums(is.na(train_samples)) == 0])[-(1:7)]
model_train_feats <- train_samples[selected_feats]
model_train_feats
dataset <- createDataPartition(y=model_train_feats$classe, p=0.75, list=FALSE )
train_data <- model_train_feats[dataset,]
test_data <- model_train_feats[-dataset,]
registerDoParallel()
x <- train_data[-ncol(train_data)]
y <- train_data$classe

classifier <- foreach(ntree=rep(20, 5), .combine=randomForest::combine, .packages='randomForest') %dopar% {
randomForest(x, y, ntree=ntree) }

outcomes <- predict(classifier, newdata=test_data)
confusionMatrix(outcomes,test_data$classe)


